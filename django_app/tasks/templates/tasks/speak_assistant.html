<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Speak Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-3"> Welcome to Your AI Speak Assistant</h2>
  <p class="lead">Try speaking one of theseâ€¦</p>
  <ul class="list-group mb-4">
    {% for action in actions %}
      <li class="list-group-item">{{ action }}</li>
    {% endfor %}
  </ul>
  <button class="btn btn-success btn-lg" onclick="startListening()">Speak Now</button>
  <button class="btn btn-success btn-lg" onclick="window.location.href='{% url 'dashboard' %}'">Go Back</button>
  <div class="mt-4">
    <h5>What you said:</h5>
    <div id="spoken-text" class="text-primary mb-2" style="font-weight: bold;"></div>
    <h5>Assistant Response:</h5>
    <div id="assistant-result" class="text-success"></div>
  </div>
</div>

<script>
function startListening() {
    alert("Mic is starting!");
    const rec = new(window.SpeechRecognition||window.webkitSpeechRecognition)();
    rec.lang = "en-US";
    rec.onerror = function(e) { 
      alert("SpeechRecognition error: " + e.error); 
      console.error("Speech error:", e);
    }
    rec.onaudiostart = function() { console.log('Audio capturing started'); }
    rec.onaudioend = function() { console.log('Audio capturing ended'); }
    rec.onend = function() { console.log('Recognition ended'); }
    rec.onstart = function() { console.log('Recognition started'); }
    rec.onresult = function(e) {
        console.log('Speech result event:', e);
        const cmd = e.results[0][0].transcript;
        document.getElementById('spoken-text').innerText = cmd; // Show exactly what was said
        fetch("http://localhost:9000/api/agentic-command/", {
            method:"POST",
            body:JSON.stringify({command:cmd}),
            headers:{"Content-Type":"application/json"}
        })
        .then(r=>r.json())
        .then(data=>{
            document.getElementById('assistant-result').innerText = data.feedback;
            if(data.action=="open" && data.url){
                window.open(data.url,"_blank");
            }
        });
    };
    document.getElementById('spoken-text').innerText = ""; // Clear previous text
    document.getElementById('assistant-result').innerText = ""; // Clear previous result
    rec.start();
}

</script>
</body>
</html>
